<html>
    <body style="background-color: black;" id = "Body">
        <div style="height: 500px; width: 200px; background-color: black;outline-style: dashed;outline-color: white; position: absolute;bottom: 1;color: white;" id = "FishList">
            FISH FISH FISH LOADING LOADING LOADING FISH FISH FISH
        </div>

        <div style="height: 40px; width: 400px; background-color: black;outline-style: dashed;outline-color: white; position: absolute;bottom: 1;color: white; right: 1;" id = "Output" >
            Output
        </div>
        
    </body>
    <script>
        let Locked = false
        const Ticks = 100
        const MaxFish = 50
        let TotalFish = 0
        let Score = 0
        FishList = document.getElementById("FishList")
        Body = document.getElementById("Body")
        let SpawnedFishes = [
            //[Name,Id,Element]
        ]
        let Fishes = [
            //["FishName",Amount,Score,MinSize,MaxSize,Weight,TiedFunction]
            ["Fish",0,10,10,20,1,function(){console.log("A") }],
            ["Fish2",0,20,10,20,0.1]
        ]
        CompileFish = function(){
            FishList.innerHTML = "Score:".concat(Score.toString()).concat("<br>")
            for (let Num = 0;Num < Fishes.length;Num++){
                if (Fishes[Num][1] > 0){
                    FishList.innerHTML += Fishes[Num][0].concat("|Amount:").concat(Fishes[Num][1].toString().concat("<br>"))
                }
            }
        }

        GetTotalWeight = function(){
            let Total = 0
            for (let Num = 0;Num < Fishes.length;Num++){
                Total += Fishes[Num][5]
            }
            return Total
        }

        GetRandomFish = function(){
            let RandNum = Math.random() * GetTotalWeight() * 100
            let CurrentWeight = 0
            for (let Num = 0;Num < Fishes.length;Num++){
                CurrentWeight += Fishes[Num][5] * 100
                if (RandNum <= CurrentWeight){
                    return Fishes[Num]
                }
            }
        }

        FishNameToFish = function(Name){
            Fishes.forEach(Fish => {
                if (Fish[0] == Name){
                    return Fish
                }
            });
            return null
        }

        FishNameToFishNum = function(Name){
            for (let Num = 0;Num < Fishes.length;Num++){
                if (Fishes[Num][0] == Name){
                    return Num
                }
            }
            return null
        }

        GetRandLocation = function(){
            let X = Math.trunc(Math.random()* 100)
            let Y = Math.trunc(Math.random()* 100)
            return [(X).toString().concat("%"),((Y).toString().concat("%")),X,Y]
        }

        CreateElement = function(FishName,FishSize){
            Div = document.createElement("div")
            Div.style.height = (5 * FishSize).toString().concat("px")
            Div.style.width = (15   * FishSize).toString().concat("px")
            Div.style.position = "absolute"
            Div.style.backgroundimage = "url(".concat( "FishImages/".concat(FishName)).concat()
            Div.style.zIndex="-1"
            Div.style.cursor= "pointer"
            Div.style.userSelect = "none"

            Img = document.createElement("img")
            Img.src = "FishImages/".concat(FishName).concat(".png")
            Img.style="object-fit: fill;width:inherit;height:inherit;user-select: none"
            
            FishLocation = GetRandLocation()
            if (FishLocation[2] > 50){
                Div.style.left = "calc(".concat(FishLocation[0]).concat(  " - ".concat((FishSize*15).toString()).concat("px)"))
            }else{
                Div.style.left = FishLocation[0]
            }

            if (FishLocation[3] > 50){
                Div.style.top = "calc(".concat(FishLocation[1]).concat(  " - ".concat((FishSize*5).toString()).concat("px)"))
            }else{
                Div.style.top = FishLocation[1]
            }
            //"calc(".concat(FishLocation[0]).concat("-").concat(FishSize*15).concat("px)")
            

            Div.style.opacity = "0"

            Div.append(Img)
            Body.append(Div)
            return(Div)
        }

        GetTime = function(){
            d = new Date
            return d.getTime()
        }

        TweenOpacity = function(Element,Time,FadeIn,CurrentOpacity){
          
            if (CurrentOpacity == null ){
                CurrentOpacity = parseFloat(Element.style.opacity) 
            }
            if (isNaN(CurrentOpacity)) {
                CurrentOpacity = 1;
            }
            if (CurrentOpacity < 1 && FadeIn == true){
             
                CurrentOpacity += 1/(Ticks*Time)
                Element.style.opacity = CurrentOpacity
                setTimeout(() => TweenOpacity(Element, Time, FadeIn, CurrentOpacity), Time / Ticks);
            }else if (CurrentOpacity > 0 && !FadeIn) {
              
                CurrentOpacity -= 1/(Ticks*Time)
                Element.style.opacity = CurrentOpacity
                setTimeout(() => TweenOpacity(Element, Time, FadeIn, CurrentOpacity), Time / Ticks);
            }
        }

        RemoveFish = function(Element,Id){
            Element.remove()
            Num = GetNumFromId(Id)
            SpawnedFishes.pop(Num)
        }

        GetNumFromId = function(Id){
            for (let Num = 0;Num < SpawnedFishes.length;Num++){
                if (SpawnedFishes[Num][1] == Id){
                    return Num
                }
            }
        }

        FishCollected = function(FishName,Element,Id,TiedFunction){
            if (Locked == true){return null}
            
            if (TiedFunction != null){
                TiedFunction()
            }
            RemoveFish(Element,Id)

            Fishes[FishNameToFishNum(FishName)][1] += 1
            Score += Fishes[FishNameToFishNum(FishName)][2]
           

            CompileFish()
        }

        SpawnFish = function(Fish){
            if (SpawnedFishes.length > MaxFish){return null}
            Fish = FishNameToFish(Fish)
            if (Fish == null){
                Fish = GetRandomFish()
            }
            let FishSize = Math.trunc((Math.random() * (Fish[4] - Fish[3])) + Fish[3])
            let FishName = Fish[0]
            let TiedFunction = Fish[6]
            let Id = TotalFish
            TotalFish += 1

            let FishElement = CreateElement(FishName,FishSize)
            SpawnedFishes.push([FishName,Id,FishElement])


            if (TiedFunction){
                FishElement.onclick = function(){
                    FishCollected(FishName,FishElement,Id,TiedFunction)
                }
            }
            else{
                FishElement.onclick = function(){
                    FishCollected(FishName,FishElement,Id)
                }
            }


            TweenOpacity(FishElement,1,true)
            
            setTimeout(() => {
                console.log(GetNumFromId(Id))
                if (GetNumFromId(Id) != null){
                    TweenOpacity(FishElement,1,false)
                    setTimeout(() => {
                        if (GetNumFromId(Id) != null){
                            RemoveFish(FishElement,Id)
                        }
                        
                    }, 1000);
                }
            }, 10000);
        }
       
        CompileFish()
        setInterval(SpawnFish,500)

        

    </script>
</html>
